<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Managed Certificate Example

This example demonstrates how to configure Azure-managed certificates for a Container Apps Managed Environment. Azure automatically provisions and renews these certificates.

> **Note**: This example requires domain ownership and DNS configuration. See Prerequisites below.

## Prerequisites

- A registered domain name that you own
- DNS management access for the domain
- Ability to create DNS records for domain validation:
  - **CNAME** record pointing to Azure validation endpoint, OR
  - **TXT** record with validation token, OR
  - **HTTP** validation file hosted on the domain

```hcl
terraform {
  required_version = ">= 1.9, < 2.0"

  required_providers {
    # ignore this because we want to force the use of AzAPI v1 within the module without having it used in this example.
    # tflint-ignore: terraform_unused_required_providers
    azapi = {
      source  = "Azure/azapi"
      version = "~> 2.0"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
  }
}

provider "azurerm" {
  resource_provider_registrations = "none"
  features {
    resource_group {
      prevent_deletion_if_contains_resources = false
    }
  }
}

# This ensures we have unique CAF compliant names for our resources.
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.4.0"
}

# This is required for resource modules
resource "azurerm_resource_group" "this" {
  location = "australiaeast"
  name     = module.naming.resource_group.name_unique
}

resource "azurerm_log_analytics_workspace" "this" {
  location            = azurerm_resource_group.this.location
  name                = module.naming.log_analytics_workspace.name_unique
  resource_group_name = azurerm_resource_group.this.name
}

module "managedenvironment" {
  source = "../../"

  location            = azurerm_resource_group.this.location
  name                = module.naming.container_app_environment.name_unique
  resource_group_name = azurerm_resource_group.this.name
  log_analytics_workspace = {
    resource_id = azurerm_log_analytics_workspace.this.id
  }
  # zone redundancy must be disabled unless we supply a subnet for vnet integration.
  zone_redundancy_enabled = false
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9, < 2.0)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.0)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.0)

## Resources

The following resources are used by this module:

- [azurerm_log_analytics_workspace.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/log_analytics_workspace) (resource)
- [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

No optional inputs.

## Outputs

The following outputs are exported:

### <a name="output_managed_certificate_resource_ids"></a> [managed\_certificate\_resource\_ids](#output\_managed\_certificate\_resource\_ids)

Description: Map of managed certificate names to their resource IDs

### <a name="output_managed_environment_default_domain"></a> [managed\_environment\_default\_domain](#output\_managed\_environment\_default\_domain)

Description: The default domain of the Managed Environment (for DNS configuration reference)

### <a name="output_managed_environment_id"></a> [managed\_environment\_id](#output\_managed\_environment\_id)

Description: The resource ID of the Container Apps Managed Environment

## Modules

The following Modules are called:

### <a name="module_managedenvironment"></a> [managedenvironment](#module\_managedenvironment)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.4.0

## Domain Validation Methods

Azure supports three domain validation methods:

### 1. CNAME Validation (Recommended)

Create a CNAME record pointing to the Azure validation endpoint:

```
_acme-challenge.yourdomain.com CNAME <validation-endpoint>
```

### 2. TXT Validation

Create a TXT record with the validation token:

```
_acme-challenge.yourdomain.com TXT <validation-token>
```

### 3. HTTP Validation

Host a validation file at:

```
http://yourdomain.com/.well-known/acme-challenge/<token>
```

## Certificate Lifecycle

- **Provisioning**: Takes several minutes after DNS validation completes
- **Renewal**: Automatically renewed by Azure before expiration
- **Validation**: Azure periodically re-validates domain ownership

## Important Notes

- DNS propagation can take up to 48 hours (typically much faster)
- The managed environment must be created before certificates can be provisioned
- Changes to validation configuration may trigger re-validation
- Managed certificates are free and automatically renewed by Azure
<!-- END_TF_DOCS -->